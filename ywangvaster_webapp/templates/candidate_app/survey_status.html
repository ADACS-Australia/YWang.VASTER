{% extends 'candidate_app/header.html' %} {% load utils %} {% block content %}


<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

<!-- Container for the heatmap -->
<div id="heatmap" style="width: 800px; height: 600px;"></div>
<script>
  // Function to generate a random 2D heatmap grid
  function generateRandomHeatmapData(rows, cols) {
    const data = [];
    for (let i = 0; i < rows; i++) {
      for (let j = 0; j < cols; j++) {
        data.push([j, i, (Math.random() * 2 - 1).toFixed(2)]);
      }
    }
    return data;
  }

  // Initialize the heatmap with the canvas renderer for better performance
  const myChart = echarts.init(document.getElementById('heatmap'), null, {
    renderer: 'canvas'
  });

  // Generate multiple datasets
  const datasets = [];
  for (let i = 0; i < 3; i++) {
    datasets.push(generateRandomHeatmapData(120, 120));
  }

  // Initial dataset index
  let currentDatasetIndex = 0;
  let intervalId;

  // Function to update the heatmap with the selected dataset
  function updateHeatmap(index) {
    currentDatasetIndex = index;
    myChart.setOption({
      series: [{
        data: datasets[currentDatasetIndex]
      }]
    });
  }

  // Specify the initial heatmap configuration
  const option = {
    tooltip: {
      position: 'top',
      formatter: function (params) {
        return `(${params.value[0]}, ${params.value[1]}): ${params.value[2]}`;
      }
    },
    grid: {
      height: '50%',
      top: '10%'
    },
    xAxis: {
      type: 'category',
      data: Array.from({
        length: 120
      }, (_, i) => i)
    },
    yAxis: {
      type: 'category',
      data: Array.from({
        length: 120
      }, (_, i) => i)
    },
    visualMap: {
      min: -1,
      max: 1,
      calculable: true,
      orient: 'horizontal',
      left: 'center',
      bottom: '15%'
    },
    series: [{
      name: 'Heatmap',
      type: 'heatmap',
      data: datasets[currentDatasetIndex],
      label: {
        show: false
      },
      emphasis: {
        itemStyle: {
          shadowBlur: 10,
          shadowColor: 'rgba(0, 0, 0, 0.5)'
        }
      }
    }]
  };

  // Set the option and render the initial heatmap
  myChart.setOption(option);

  // Function to start the automatic transition
  function startAnimation() {
    intervalId = setInterval(() => {
      const nextIndex = (currentDatasetIndex + 1) % datasets.length;
      updateHeatmap(nextIndex);
    }, 2000);
  }

  // Start the animation by default
  startAnimation();
</script>



<h2>Survey Status</h2>
<p>
  <a href="/download_data/observation/" class="btn btn-primary btn-lg" tabindex="-1" role="button"
    aria-disabled="true">Download All Observations</a>
</p>
<div>
  {% if obs %}
  <table class="fl-table">
    <thead>
      <th><a href="?{% url_replace request 'order_by' 'obsname' '-' %}">Name</a></th>
      <th><a href="?{% url_replace request 'order_by' 'observation_id' '-' %}">Obs_ID</a></th>
      <th>
        <a href="?{% url_replace request 'order_by' 'rated_candidates' '-' %}">Candidates Rated</a> /
        <a href="?{% url_replace request 'order_by' 'candidates' '-' %}">Candidates Uploaded</a>
      </th>
      <th><a href="?{% url_replace request 'order_by' 'ra_tile_hms' '-' %}">RA (HH:MM:SS.SS)</a></th>
      <th><a href="?{% url_replace request 'order_by' 'dec_tile_dms' '-' %}">Dec (DD:MM:SS.SS)</a></th>
      <th><a href="?{% url_replace request 'order_by' 'cent_freq' '-' %}">Centre Frequency (MHz)</a></th>
    </thead>
    {% for acc in obs %}
    <tr>
      <td>{{ acc.obsname }}</td>
      <td>
        <a href="http://ws.mwatelescope.org/observation/obs/?obs_id={{ acc.observation_id }}"
          target="_blank">{{ acc.observation_id }}</a>
      </td>
      <td>{{ acc.rated_candidates }}/{{ acc.candidates }}</td>
      <td>{{ acc.ra_tile_hms }}</td>
      <td>{{ acc.dec_tile_dms }}</td>
      <td>{{ acc.cent_freq }}</td>
    </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>No Access records Found!</p>
  {% endif %}
</div>
{% endblock %}